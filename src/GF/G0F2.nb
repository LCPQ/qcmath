(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[      9061,        203]
NotebookOptionsPosition[      8683,        188]
NotebookOutlinePosition[      9107,        205]
CellTagsIndexPosition[      9064,        202]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"G0F2", "[", 
    RowBox[{
    "nBas_", ",", "nO_", ",", "nV_", ",", "nS_", ",", "\[Epsilon]HF_", ",", 
     "ERI_", ",", "\[Eta]_", ",", "Regularized_", ",", "\[Kappa]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[CapitalSigma]c", ",", "Z", ",", "\[Epsilon]G0F2", ",", "EcMP2", ",", 
       "quantities", ",", "SelfEnergy", ",", "Im\[CapitalSigma]c\[Omega]", 
       ",", "\[CapitalSigma]c\[Omega]", ",", "Im\[CapitalSigma]c", ",", 
       "lin"}], "}"}], ",", "\n", "\n", 
     RowBox[{
      RowBox[{"\[Epsilon]G0F2", "=", "\[Epsilon]HF"}], ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{"Regularized", ",", "\n", 
        RowBox[{
         RowBox[{"NotebookEvaluate", "[", 
          RowBox[{
          "path", "<>", "\"\</src/GF/regularized_self_energy_diag.nb\>\""}], 
          "]"}], ";", "\n", 
         RowBox[{"SelfEnergy", "=", 
          RowBox[{"RegularizedSelfEnergyGF2diag", "[", 
           RowBox[{
           "nBas", ",", "nO", ",", "nV", ",", "nS", ",", "\[Epsilon]HF", ",", 
            "\[Epsilon]HF", ",", "ERI", ",", "\[Kappa]"}], "]"}]}]}], ",", 
        "\n", "\n", 
        RowBox[{"(*", "else", "*)"}], "\n", "\n", 
        RowBox[{
         RowBox[{"NotebookEvaluate", "[", 
          RowBox[{"path", "<>", "\"\</src/GF/self_energy_diag.nb\>\""}], 
          "]"}], ";", "\n", 
         RowBox[{"SelfEnergy", "=", 
          RowBox[{"SelfEnergyGF2diag", "[", 
           RowBox[{
           "nBas", ",", "nO", ",", "nV", ",", "\[Epsilon]HF", ",", "ERI", ",",
             "\[Eta]"}], "]"}]}]}]}], "\n", "]"}], ";", "\n", "\n", 
      RowBox[{"\[CapitalSigma]c", "=", 
       RowBox[{"SelfEnergy", "[", "\"\<\[CapitalSigma]c\>\"", "]"}]}], ";", 
      "\n", 
      RowBox[{"Im\[CapitalSigma]c\[Omega]", "=", "\[CapitalSigma]c"}], ";", 
      "\n", 
      RowBox[{"\[CapitalSigma]c\[Omega]", "=", 
       RowBox[{"Re", "[", "\[CapitalSigma]c", "]"}]}], ";", "\n", 
      RowBox[{"\[CapitalSigma]c", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "\[CapitalSigma]c", "\[LeftDoubleBracket]", "p", 
           "\[RightDoubleBracket]"}], "/.", 
          RowBox[{"\[Omega]", "\[Rule]", 
           RowBox[{
           "\[Epsilon]G0F2", "\[LeftDoubleBracket]", "p", 
            "\[RightDoubleBracket]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}], ";", "\n", 
      RowBox[{"Im\[CapitalSigma]c", "=", "\[CapitalSigma]c"}], ";", "\n", 
      "\n", 
      RowBox[{"Z", "=", 
       RowBox[{"SelfEnergy", "[", "\"\<Z\>\"", "]"}]}], ";", "\n", 
      RowBox[{"Z", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Z", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}],
           "/.", 
          RowBox[{"\[Omega]", "\[Rule]", 
           RowBox[{
           "\[Epsilon]G0F2", "\[LeftDoubleBracket]", "p", 
            "\[RightDoubleBracket]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}], ";", "\n", 
      RowBox[{"\[CapitalSigma]c", "=", 
       RowBox[{"Re", "[", "\[CapitalSigma]c", "]"}]}], ";", "\n", 
      RowBox[{"Z", "=", 
       RowBox[{"Re", "[", "Z", "]"}]}], ";", "\n", 
      RowBox[{"Z", "=", 
       FractionBox["1", 
        RowBox[{"1", "-", "Z"}]]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{"Linearized", " ", "Quasiparticle", " ", "equation"}], "*)"}], 
      "\n", 
      RowBox[{"lin", "=", "True"}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{"lin", ",", 
        RowBox[{"\[Epsilon]G0F2", "=", 
         RowBox[{"\[Epsilon]HF", "+", 
          RowBox[{"Z", "*", "\[CapitalSigma]c"}]}]}], ",", "\n", 
        RowBox[{
         RowBox[{"\[Epsilon]G0F2", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"FindRoot", "[", 
             RowBox[{
              RowBox[{"\[Omega]", "\[Equal]", 
               RowBox[{
                RowBox[{
                "\[Epsilon]HF", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{
                "\[CapitalSigma]c\[Omega]", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}]}]}], ",", 
              RowBox[{"{", 
               RowBox[{"\[Omega]", ",", 
                RowBox[{
                "\[Epsilon]HF", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}], ";"}]}], "\n", 
       "]"}], ";", "\n", "\n", 
      RowBox[{"NotebookEvaluate", "[", 
       RowBox[{"path", "<>", "\"\</src/MP/MP2.nb\>\""}], "]"}], ";", "\n", 
      RowBox[{"EcMP2", "=", 
       RowBox[{"MP2", "[", 
        RowBox[{"nBas", ",", "nO", ",", "ERI", ",", "\[Epsilon]G0F2"}], 
        "]"}]}], ";", "\n", "\n", 
      RowBox[{"quantities", "=", 
       RowBox[{"Association", "[", 
        RowBox[{
         RowBox[{"\"\<EcMP2\>\"", "\[Rule]", "EcMP2"}], ",", 
         RowBox[{"\"\<\[Epsilon]G0F2\>\"", "\[Rule]", "\[Epsilon]G0F2"}]}], 
        "]"}]}], ";", "\n", "\n", 
      RowBox[{"Return", "[", "quantities", "]"}]}]}], "]"}]}], ";"}]], "Code",\

 CellChangeTimes->{{3.8420876295757647`*^9, 3.842087659754704*^9}, {
   3.842088211464518*^9, 3.842088229153015*^9}, {3.8420887529038773`*^9, 
   3.842088821454864*^9}, {3.8420890522480907`*^9, 3.842089105872657*^9}, {
   3.8423204101144133`*^9, 3.842320441960772*^9}, {3.842320474694746*^9, 
   3.84232061237916*^9}, {3.842320658971733*^9, 3.842320839527431*^9}, {
   3.8423209404083977`*^9, 3.8423209595073442`*^9}, {3.842321054233315*^9, 
   3.8423213800667677`*^9}, {3.8423215033458347`*^9, 3.84232150351388*^9}, {
   3.842321666859148*^9, 3.842321672181097*^9}, {3.842321785745681*^9, 
   3.842321786033062*^9}, {3.842321950947926*^9, 3.8423219542534447`*^9}, {
   3.84232201920851*^9, 3.842322020296088*^9}, {3.8423222620341673`*^9, 
   3.8423222647715387`*^9}, {3.8423223111772633`*^9, 3.84232231156459*^9}, {
   3.842322368941865*^9, 3.842322369125618*^9}, {3.842322537239377*^9, 
   3.842322539950079*^9}, {3.842325654930068*^9, 3.8423256556893597`*^9}, {
   3.8423267148759003`*^9, 3.8423267157063437`*^9}, {3.8423267909361143`*^9, 
   3.84232681395383*^9}, {3.8423268769961348`*^9, 3.842326915356085*^9}, {
   3.842603140285863*^9, 3.842603146549316*^9}, {3.842603254245565*^9, 
   3.842603254934999*^9}, {3.842603306836711*^9, 3.8426033072735567`*^9}, {
   3.847855105798903*^9, 3.847855127888674*^9}, {3.847856959466967*^9, 
   3.847856966943791*^9}, {3.848719148336141*^9, 3.848719174446568*^9}, {
   3.8487198136769333`*^9, 3.8487198311425543`*^9}, {3.851058529384823*^9, 
   3.8510585369374123`*^9}, {3.851063955018815*^9, 3.8510640004287987`*^9}, {
   3.851064894119978*^9, 3.851064933779964*^9}, {3.8510661212632837`*^9, 
   3.8510661287179813`*^9}, {3.8514041681819*^9, 3.851404224559904*^9}, {
   3.851404399492524*^9, 3.8514044038353024`*^9}, {3.851404472001008*^9, 
   3.85140454439434*^9}, {3.851404754722271*^9, 3.851404755151963*^9}, {
   3.851404795679611*^9, 3.851404860116864*^9}, {3.851410461064536*^9, 
   3.8514104636828537`*^9}, {3.8514105645704613`*^9, 3.851410575380168*^9}, {
   3.8514106165636063`*^9, 3.851410618168762*^9}, {3.851410935234974*^9, 
   3.851410949389628*^9}, {3.85141121176505*^9, 3.851411211902614*^9}, {
   3.851411450394372*^9, 3.851411455074335*^9}, {3.872842911111689*^9, 
   3.872843064577314*^9}, {3.8728431840117483`*^9, 3.8728432190177803`*^9}, {
   3.872843269276711*^9, 3.872843301562087*^9}, {3.87284353361654*^9, 
   3.872843560859976*^9}, {3.872843722786684*^9, 3.872843734609262*^9}, {
   3.872844584993712*^9, 3.872844592353293*^9}, {3.8728449279603977`*^9, 
   3.87284494238451*^9}, {3.8728458797168427`*^9, 3.8728458854851*^9}, {
   3.872846661060586*^9, 3.872846663184226*^9}, {3.8728469346597433`*^9, 
   3.8728469349801197`*^9}, {3.872846997091865*^9, 3.872846998282906*^9}, 
   3.87284705344479*^9},ExpressionUUID->"66b75e44-7fca-472b-a797-\
b8ce2c44c8ba"]
},
WindowSize->{1193, 650},
WindowMargins->{{Automatic, 67}, {Automatic, 59}},
Magnification:>1.5 Inherited,
FrontEndVersion->"12.1 for Mac OS X x86 (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"94f79a86-77f9-4e19-9732-0be130340b6a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 8121, 166, 1223, "Code",ExpressionUUID->"66b75e44-7fca-472b-a797-b8ce2c44c8ba"]
}
]
*)

