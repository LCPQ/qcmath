(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     67091,       1493]
NotebookOptionsPosition[     66138,       1467]
NotebookOutlinePosition[     66562,       1484]
CellTagsIndexPosition[     66519,       1481]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["G0F2", "Title",
 CellChangeTimes->{{3.898071751619742*^9, 
  3.898071752733844*^9}},ExpressionUUID->"e87254f3-ed3e-4a9e-8fd0-\
285578ce8bdf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"G0F2", "[", 
   RowBox[{
   "nBas_", ",", "nO_", ",", "nV_", ",", "eHF_", ",", "ERI_", ",", "ENuc_", 
    ",", "ERHF_", ",", "options_", ",", "verbose_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{"regularizermethod", ",", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Option", " ", "to", " ", "choose", " ", "the", " ", "regularizer", 
        " ", "of", " ", "quasiparticle", " ", "equations"}], " ", "*)"}], 
      "\n", "s", ",", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Value", " ", "of", " ", "the", " ", "regularizer", " ", "parameter"}],
        " ", "*)"}], "\n", "\[Eta]", ",", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Value", " ", "of", " ", "the", " ", "broadening", " ", "imaginary", 
        " ", "constant"}], " ", "*)"}], "\n", "lin", ",", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Don", "'"}], "t", " ", "solve", " ", "the", " ", "nonlinear",
         " ", "qp", " ", "equation", " ", "and", " ", "use", " ", 
        "approximate", " ", "linearized", " ", "qp", " ", "energies"}], " ", 
       "*)"}], "\n", "regularizerorbital", ",", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Regularizer", " ", "for", " ", "the", " ", "static", " ", "part"}], 
       " ", "*)"}], "\n", "regularizerselfenergy", ",", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Regularizer", " ", "for", " ", "the", " ", "dynamic", " ", "part"}], 
       " ", "*)"}], "\n", "outputsGF2"}], "}"}], ",", "\n", "\n", 
    RowBox[{
     RowBox[{"regularizermethod", " ", "=", " ", 
      RowBox[{"options", "[", 
       RowBox[{"[", "\"\<MBPT_regularizer_methods\>\"", "]"}], "]"}]}], ";", 
     "\n", 
     RowBox[{"s", " ", "=", " ", 
      RowBox[{"options", "[", 
       RowBox[{"[", "\"\<MBPT_regularizer_value\>\"", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\n", 
     RowBox[{
      RowBox[{"regularizerorbital", "[", "\[CapitalDelta]_", "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "}"}], ",", "\n", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"regularizermethod", "==", "None"}], ",", " ", 
           RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"regularizermethod", "==", "\"\<MonLoo\>\""}], ",", " ", 
           RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"regularizermethod", "==", "\"\<SRG\>\""}], ",", " ", 
           RowBox[{"Return", "[", 
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", "2"}], "s", " ", 
              SuperscriptBox["\[CapitalDelta]", "2"]}], "]"}], "]"}]}], "]"}],
          ";"}]}], "\n", "]"}]}], ";", "\[IndentingNewLine]", "\n", 
     RowBox[{
      RowBox[{"regularizerselfenergy", "[", "\[CapitalDelta]_", "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "}"}], ",", "\n", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"regularizermethod", "==", "None"}], ",", " ", 
           RowBox[{"Return", "[", "1", "]"}]}], "]"}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"regularizermethod", "==", "\"\<MonLoo\>\""}], ",", " ", 
           RowBox[{"Return", "[", 
            RowBox[{"1", " ", "-", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "2"}], "s", " ", 
               SuperscriptBox["\[CapitalDelta]", "2"]}], "]"}]}], "]"}]}], 
          "]"}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"regularizermethod", "==", "\"\<SRG\>\""}], ",", " ", 
           RowBox[{"Return", "[", 
            RowBox[{"1", " ", "-", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "2"}], "s", " ", 
               SuperscriptBox["\[CapitalDelta]", "2"]}], "]"}]}], "]"}]}], 
          "]"}], ";"}]}], "\n", "]"}]}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"options", "[", "\"\<spinorbital\>\"", "]"}], "==", "True"}], 
       ",", "\n", "\n", "  ", 
       RowBox[{
        RowBox[{"outputsGF2", " ", "=", " ", 
         RowBox[{"spinorbG0F2", "[", 
          RowBox[{
          "nBas", ",", "nO", ",", "nV", ",", "eHF", ",", "ERI", ",", "ENuc", 
           ",", "ERHF", ",", "options", ",", "verbose", ",", 
           "regularizerorbital", ",", "regularizerselfenergy"}], "]"}]}], 
        ";"}], "\n", "  ", "\n", "  ", ",", 
       RowBox[{"(*", 
        RowBox[{"else", " ", "go", " ", "to", " ", "spatial"}], " ", "*)"}], 
       "\n", "  ", "\n", "  ", 
       RowBox[{
        RowBox[{"outputsGF2", " ", "=", " ", 
         RowBox[{"spatialorbG0F2", "[", 
          RowBox[{
          "nBas", ",", "nO", ",", "nV", ",", "eHF", ",", "ERI", ",", "ENuc", 
           ",", "ERHF", ",", "options", ",", "verbose", ",", 
           "regularizerorbital", ",", "regularizerselfenergy"}], "]"}]}], 
        ";"}]}], "\n", "\n", "]"}], ";", "\n", "\t", "\n", 
     RowBox[{"Return", "[", "outputsGF2", "]"}], ";"}]}], "\n", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.877680179723378*^9, 3.87768020172503*^9}, {
   3.877687960895183*^9, 3.87768803061088*^9}, {3.8776880681816*^9, 
   3.877688270429729*^9}, {3.8776885524318438`*^9, 3.877688632119705*^9}, {
   3.877688686185315*^9, 3.87768868861136*^9}, 3.8776890661705008`*^9, {
   3.877689597346311*^9, 3.877689697488616*^9}, {3.877689984714643*^9, 
   3.877689990834032*^9}, {3.877690318825542*^9, 3.8776903343120613`*^9}, {
   3.877690375186058*^9, 3.877690415230291*^9}, {3.878007047317452*^9, 
   3.878007047581683*^9}, {3.878007399745657*^9, 3.878007540440433*^9}, {
   3.878007622099257*^9, 3.878007644652177*^9}, 3.8780112529189873`*^9, {
   3.878026563668294*^9, 3.878026566148128*^9}, {3.878619114714871*^9, 
   3.87861916303771*^9}, 3.878619534658888*^9, {3.8980719903146677`*^9, 
   3.898072057483569*^9}, {3.8980721362762823`*^9, 3.8980721417486353`*^9}, {
   3.898137961486949*^9, 3.8981379958994207`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"be91d493-19ce-4a16-83f6-affcdb4c3468"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spin orbitals\t", "Title",
 CellChangeTimes->{{3.878006900414748*^9, 
  3.8780069108646507`*^9}},ExpressionUUID->"ab838407-d2cf-4002-b195-\
ee7d9e90a2db"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"spinorbG0F2", "[", 
    RowBox[{
    "nBas_", ",", "nO_", ",", "nV_", ",", "\[Epsilon]_", ",", "ERI_", ",", 
     "ENuc_", ",", "ERHF_", ",", "options_", ",", "verbose_", ",", 
     "regularizerorbital_", ",", "regularizerselfenergy_"}], "]"}], ":=", 
   "\n", "       ", "\n", "  ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Eta]", ",", "lin", ",", "\[CapitalSigma]x", ",", "\[CapitalSigma]c", 
       ",", "Z", ",", "d\[CapitalSigma]cd\[Omega]", ",", "soeG0F2", ",", 
       "EcG0F2", ",", "outputs", ",", "SelfEnergy", ",", 
       "Im\[CapitalSigma]c\[Omega]", ",", "\[CapitalSigma]c\[Omega]", ",", 
       "Im\[CapitalSigma]c", ",", "\n", "          ", "nBas2", ",", "nO2", 
       ",", "so\[Epsilon]", ",", "soERI", ",", "soeG0F2lin", ",", "IP", ",", 
       "soeRenorm", ",", "TabG0F2"}], "}"}], ",", "\n", "          ", "\n", 
     "    ", 
     RowBox[{"(*", "options", "*)"}], "      ", "\n", "    ", 
     RowBox[{
      RowBox[{"\[Eta]", "=", 
       RowBox[{"options", "[", "\"\<\[Eta]\>\"", "]"}]}], ";", "\n", "    ", 
      RowBox[{"lin", "=", 
       RowBox[{"options", "[", "\"\<linearized\>\"", "]"}]}], ";", "\n", 
      "    ", "\n", "    ", 
      RowBox[{"(*", " ", 
       RowBox[{"Define", " ", "spaces"}], "*)"}], "\n", "    ", 
      RowBox[{"nBas2", "=", 
       RowBox[{"2", "nBas"}]}], ";", "\n", "    ", 
      RowBox[{"nO2", "=", 
       RowBox[{"2", "nO"}]}], ";", "\n", "    ", "\n", "\n", "    ", 
      RowBox[{"(*", 
       RowBox[{"Spatial", " ", "to", " ", "spin", " ", "orbitals"}], "*)"}], 
      "\n", "    ", 
      RowBox[{"NotebookEvaluate", "[", 
       RowBox[{
       "path", "<>", "\"\</src/utils/spatial_to_spin_MO_energy.nb\>\""}], 
       "]"}], ";", "\n", "    ", 
      RowBox[{"NotebookEvaluate", "[", 
       RowBox[{"path", "<>", "\"\</src/utils/spatial_to_spin_ERI.nb\>\""}], 
       "]"}], ";", "\n", "\n", "    ", 
      RowBox[{"so\[Epsilon]", " ", "=", " ", 
       RowBox[{"SpatialToSpinMOEnergy", "[", 
        RowBox[{"nBas", ",", "nO", ",", "nV", ",", "\[Epsilon]"}], "]"}]}], 
      ";", "\n", "    ", 
      RowBox[{"soERI", " ", "=", " ", 
       RowBox[{"SpatialToSpinERI", "[", 
        RowBox[{"nBas", ",", "nO", ",", "nV", ",", "ERI"}], "]"}]}], ";", 
      "\n", "\n", "    ", 
      RowBox[{"(*", 
       RowBox[{"Anti", "-", 
        RowBox[{"symmetrized", " ", "ERIs"}]}], "*)"}], "\n", "    ", 
      RowBox[{"soERI", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"soERI", "\[LeftDoubleBracket]", 
           RowBox[{"p", ",", "q", ",", "r", ",", "t"}], 
           "\[RightDoubleBracket]"}], "-", 
          RowBox[{"soERI", "\[LeftDoubleBracket]", 
           RowBox[{"p", ",", "q", ",", "t", ",", "r"}], 
           "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "nBas2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"q", ",", "nBas2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"r", ",", "nBas2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "nBas2"}], "}"}]}], "]"}]}], ";", "\n", "\n", 
      "    ", 
      RowBox[{"soeG0F2", " ", "=", " ", "so\[Epsilon]"}], ";", "\n", "    ", 
      "\n", "    ", 
      RowBox[{"(*", " ", 
       RowBox[{"Renormalized", " ", "orbital", " ", "energies"}], " ", "*)"}],
       "\n", "    ", "\n", "    ", 
      RowBox[{"soeRenorm", " ", "=", " ", 
       RowBox[{"so\[Epsilon]", " ", "+", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           FractionBox["1", "2"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"i", "=", "1"}], "nO2"], 
            RowBox[{
             UnderoverscriptBox["\[Sum]", 
              RowBox[{"j", "=", "1"}], "nO2"], 
             RowBox[{
              UnderoverscriptBox["\[Sum]", 
               RowBox[{"a", "=", 
                RowBox[{"nO2", "+", "1"}]}], "nBas2"], 
              RowBox[{
               FractionBox[
                SuperscriptBox[
                 RowBox[{"soERI", "\[LeftDoubleBracket]", 
                  RowBox[{"p", ",", "a", ",", "i", ",", "j"}], 
                  "\[RightDoubleBracket]"}], "2"], 
                RowBox[{
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}], "+", 
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}]], 
               RowBox[{"regularizerorbital", "[", 
                RowBox[{
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}], "+", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                    "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas2"}], "}"}]}], "]"}]}]}], ";", "\n", "    ", 
      RowBox[{"soeRenorm", " ", "=", " ", 
       RowBox[{"soeRenorm", " ", "+", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           FractionBox["1", "2"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"i", "=", "1"}], "nO2"], 
            RowBox[{
             UnderoverscriptBox["\[Sum]", 
              RowBox[{"a", "=", 
               RowBox[{"nO2", "+", "1"}]}], "nBas2"], 
             RowBox[{
              UnderoverscriptBox["\[Sum]", 
               RowBox[{"b", "=", 
                RowBox[{"nO2", "+", "1"}]}], "nBas2"], 
              RowBox[{
               FractionBox[
                SuperscriptBox[
                 RowBox[{"soERI", "\[LeftDoubleBracket]", 
                  RowBox[{"p", ",", "i", ",", "a", ",", "b"}], 
                  "\[RightDoubleBracket]"}], "2"], 
                RowBox[{
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}], "+", 
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                  "\[RightDoubleBracket]"}], "+", 
                 RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}]], 
               RowBox[{"regularizerorbital", "[", 
                RowBox[{
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}], "+", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                    "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                    "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas2"}], "}"}]}], "]"}]}]}], ";", "\n", "\t", 
      RowBox[{"soeRenorm", " ", "=", " ", 
       RowBox[{"Re", "[", "soeRenorm", "]"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{"Self", " ", "energy"}], "*)"}], "\n", "\t", 
      RowBox[{"\[CapitalSigma]c\[Omega]", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          FractionBox["1", "2"], 
          RowBox[{
           UnderoverscriptBox["\[Sum]", 
            RowBox[{"i", "=", "1"}], "nO2"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"j", "=", "1"}], "nO2"], 
            RowBox[{
             UnderoverscriptBox["\[Sum]", 
              RowBox[{"a", "=", 
               RowBox[{"nO2", "+", "1"}]}], "nBas2"], 
             RowBox[{
              FractionBox[
               SuperscriptBox[
                RowBox[{"soERI", "\[LeftDoubleBracket]", 
                 RowBox[{"p", ",", "a", ",", "i", ",", "j"}], 
                 "\[RightDoubleBracket]"}], "2"], 
               RowBox[{"\[Omega]", "+", 
                RowBox[{
                "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                 "\[RightDoubleBracket]"}], "-", 
                RowBox[{
                "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "-", 
                RowBox[{
                "so\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                 "\[RightDoubleBracket]"}], "-", 
                RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}]], 
              RowBox[{"regularizerselfenergy", "[", 
               RowBox[{
                RowBox[{
                "so\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                  "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "so\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                   "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "nBas2"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"\[CapitalSigma]c\[Omega]", "=", 
       RowBox[{"\[CapitalSigma]c\[Omega]", "+", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           FractionBox["1", "2"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"i", "=", "1"}], "nO2"], 
            RowBox[{
             UnderoverscriptBox["\[Sum]", 
              RowBox[{"a", "=", 
               RowBox[{"nO2", "+", "1"}]}], "nBas2"], 
             RowBox[{
              UnderoverscriptBox["\[Sum]", 
               RowBox[{"b", "=", 
                RowBox[{"nO2", "+", "1"}]}], "nBas2"], 
              RowBox[{
               FractionBox[
                SuperscriptBox[
                 RowBox[{"soERI", "\[LeftDoubleBracket]", 
                  RowBox[{"p", ",", "i", ",", "a", ",", "b"}], 
                  "\[RightDoubleBracket]"}], "2"], 
                RowBox[{"\[Omega]", "+", 
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                  "\[RightDoubleBracket]"}], "+", 
                 RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}]], 
               RowBox[{"regularizerselfenergy", "[", 
                RowBox[{
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}], "+", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                    "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                    "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas2"}], "}"}]}], "]"}]}]}], ";", "\n", "\t", 
      RowBox[{"\[CapitalSigma]c\[Omega]", " ", "=", " ", 
       RowBox[{"Re", "[", "\[CapitalSigma]c\[Omega]", "]"}]}], ";", "\n", 
      "\t", "\n", "\t", "\n", "\t", 
      RowBox[{"\[CapitalSigma]c", " ", "=", " ", 
       RowBox[{"Re", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "\[CapitalSigma]c\[Omega]", "\[LeftDoubleBracket]", "p", 
            "\[RightDoubleBracket]"}], "/.", 
           RowBox[{"\[Omega]", "\[Rule]", 
            RowBox[{
            "soeRenorm", "\[LeftDoubleBracket]", "p", 
             "\[RightDoubleBracket]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas2"}], "}"}]}], "]"}], "]"}]}], ";", "\n", 
      "\t", "\n", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{"Renormalization", " ", "factor"}], " ", "*)"}], "\n", "\t", 
      RowBox[{"d\[CapitalSigma]cd\[Omega]", " ", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          FractionBox["1", "2"], 
          RowBox[{
           UnderoverscriptBox["\[Sum]", 
            RowBox[{"i", "=", "1"}], "nO2"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"j", "=", "1"}], "nO2"], 
            RowBox[{
             UnderoverscriptBox["\[Sum]", 
              RowBox[{"a", "=", 
               RowBox[{"nO2", "+", "1"}]}], "nBas2"], 
             RowBox[{
              FractionBox[
               RowBox[{"-", 
                SuperscriptBox[
                 RowBox[{"soERI", "\[LeftDoubleBracket]", 
                  RowBox[{"p", ",", "a", ",", "i", ",", "j"}], 
                  "\[RightDoubleBracket]"}], "2"]}], 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Omega]", "+", 
                  RowBox[{
                  "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "so\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}], ")"}], "2"]], 
              RowBox[{"regularizerselfenergy", "[", 
               RowBox[{
                RowBox[{
                "so\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                  "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "so\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                   "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "nBas2"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"d\[CapitalSigma]cd\[Omega]", " ", "=", " ", 
       RowBox[{"d\[CapitalSigma]cd\[Omega]", " ", "+", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           FractionBox["1", "2"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"i", "=", "1"}], "nO2"], 
            RowBox[{
             UnderoverscriptBox["\[Sum]", 
              RowBox[{"a", "=", 
               RowBox[{"nO2", "+", "1"}]}], "nBas2"], 
             RowBox[{
              UnderoverscriptBox["\[Sum]", 
               RowBox[{"b", "=", 
                RowBox[{"nO2", "+", "1"}]}], "nBas2"], 
              RowBox[{
               FractionBox[
                RowBox[{"-", 
                 SuperscriptBox[
                  RowBox[{"soERI", "\[LeftDoubleBracket]", 
                   RowBox[{"p", ",", "i", ",", "a", ",", "b"}], 
                   "\[RightDoubleBracket]"}], "2"]}], 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"\[Omega]", "+", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                    "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                    "\[RightDoubleBracket]"}], "+", 
                   RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}], ")"}], "2"]], 
               RowBox[{"regularizerselfenergy", "[", 
                RowBox[{
                 RowBox[{
                 "so\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}], "+", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                    "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "so\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                    "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas2"}], "}"}]}], "]"}]}]}], ";", "\n", "\t", 
      "\n", "\t", 
      RowBox[{"d\[CapitalSigma]cd\[Omega]", " ", "=", " ", 
       RowBox[{"Re", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "d\[CapitalSigma]cd\[Omega]", "\[LeftDoubleBracket]", "p", 
            "\[RightDoubleBracket]"}], "/.", 
           RowBox[{"\[Omega]", "\[Rule]", 
            RowBox[{
            "so\[Epsilon]", "\[LeftDoubleBracket]", "p", 
             "\[RightDoubleBracket]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas2"}], "}"}]}], "]"}], "]"}]}], ";", "\n", 
      "\t", 
      RowBox[{"Z", " ", "=", " ", 
       FractionBox["1", 
        RowBox[{"1", "-", "d\[CapitalSigma]cd\[Omega]"}]]}], ";", "\n", "\n", 
      "    ", 
      RowBox[{"(*", 
       RowBox[{"Linearized", " ", "Quasiparticle", " ", "equation"}], "*)"}], 
      "\n", "    ", 
      RowBox[{"soeG0F2lin", " ", "=", " ", 
       RowBox[{"soeRenorm", " ", "+", " ", 
        RowBox[{"Z", "*", "\[CapitalSigma]c"}]}]}], " ", ";", "\n", "\n", 
      "    ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"lin", "\[Equal]", "True"}], ",", "\n", "    ", "\n", 
        "      ", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"verbose", "\[Equal]", "True"}], ",", " ", "\n", 
           "        ", 
           RowBox[{
            RowBox[{
            "Print", "[", "\"\<QP energies obtained by linearization !\>\"", 
             "]"}], ";"}], "\n", "        ", ",", 
           RowBox[{"(*", "else", "*)"}], "\n", "        ", 
           RowBox[{
            RowBox[{
            "PrintTemporary", "[", 
             "\"\<QP energies obtained by linearization !\>\"", "]"}], 
            ";"}]}], "\n", "      ", "]"}], ";", "\n", "        ", "\n", 
         "      ", 
         RowBox[{"soeG0F2", " ", "=", " ", "soeG0F2lin"}]}], ",", "\n", 
        "      ", "\n", "      ", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"verbose", "\[Equal]", "True"}], ",", " ", "\n", 
           "        ", 
           RowBox[{
            RowBox[{
            "Print", "[", "\"\<QP energies obtained by root search !\>\"", 
             "]"}], ";"}], "\n", "        ", ",", 
           RowBox[{"(*", "else", "*)"}], "\n", "        ", 
           RowBox[{
            RowBox[{
            "PrintTemporary", "[", 
             "\"\<QP energies obtained by root search !\>\"", "]"}], ";"}]}], 
          "\n", "        ", "]"}], ";", "\n", "        ", "\n", "      ", 
         RowBox[{"soeG0F2", " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"\[Omega]", "/.", 
             RowBox[{"FindRoot", "[", 
              RowBox[{
               RowBox[{"\[Omega]", "\[Equal]", 
                RowBox[{
                 RowBox[{
                 "soeRenorm", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}], "+", 
                 RowBox[{
                 "\[CapitalSigma]c\[Omega]", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Omega]", ",", 
                 RowBox[{
                 "soeG0F2lin", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}]}], "}"}]}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"p", ",", "nBas2"}], "}"}]}], "]"}]}], ";"}]}], "\n", 
       "      ", "\n", "    ", "]"}], ";", "\n", "    ", "\n", "    ", 
      RowBox[{"(*", " ", 
       RowBox[{"Choose", " ", "the", " ", "first", " ", "IP"}], " ", "*)"}], 
      "\n", "    ", 
      RowBox[{"IP", "=", 
       RowBox[{
        RowBox[{
        "soeG0F2", "\[LeftDoubleBracket]", "nO2", "\[RightDoubleBracket]"}], 
        "*", "HaToeV"}]}], ";", "\n", "\n", "    ", 
      RowBox[{"(*", " ", 
       RowBox[{"MP2", " ", "correlation", " ", "energy"}], " ", "*)"}], "\n", 
      "    ", 
      RowBox[{"NotebookEvaluate", "[", 
       RowBox[{"path", "<>", "\"\</src/MP/MP2.nb\>\""}], "]"}], ";", "\n", 
      "    ", 
      RowBox[{"EcG0F2", " ", "=", " ", 
       RowBox[{"MP2", "[", 
        RowBox[{"nBas", ",", "nO", ",", "ERI", ",", 
         RowBox[{"soeG0F2", "\[LeftDoubleBracket]", 
          RowBox[{";;", " ", ";;", " ", "2"}], "\[RightDoubleBracket]"}], ",",
          "options"}], "]"}]}], ";", "\n", "    ", "\n", "    ", 
      RowBox[{"(*", 
       RowBox[{"Print", " ", "outputs"}], "*)"}], "\n", "    ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"verbose", "\[Equal]", "True"}], ",", "\n", "      ", 
        RowBox[{
         RowBox[{"NotebookEvaluate", "[", 
          RowBox[{"path", "<>", "\"\</src/GF/print_G0F2.nb\>\""}], "]"}], ";",
          "\n", "      ", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<G0F2 outputs:\>\"", ",", "Bold", ",", "Red"}], "]"}], 
          "]"}], ";", "\n", "      ", 
         RowBox[{"TabG0F2", " ", "=", " ", 
          RowBox[{"PrintG0F2", "[", 
           RowBox[{
           "nO2", ",", "so\[Epsilon]", ",", "\[CapitalSigma]c", ",", "Z", ",",
             "soeG0F2", ",", "ENuc", ",", "ERHF", ",", "EcG0F2"}], "]"}]}], 
         ";", "\n", "      ", 
         RowBox[{"Print", "[", "TabG0F2", "]"}], ";"}]}], "\n", "    ", "]"}],
       ";", "\n", "\n", "    ", 
      RowBox[{"outputs", " ", "=", " ", 
       RowBox[{"Association", "[", 
        RowBox[{
         RowBox[{"\"\<EcMP2\>\"", "\[Rule]", "EcG0F2"}], ",", 
         RowBox[{"\"\<soeG0F2\>\"", "\[Rule]", "soeG0F2"}], ",", 
         RowBox[{"\"\<IP\>\"", "\[Rule]", "IP"}]}], "]"}]}], ";", "\n", "\n", 
      "    ", 
      RowBox[{"Return", "[", "outputs", "]"}]}]}], "\n", "  ", "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.872844083344153*^9, 3.8728441243136063`*^9}, {
   3.8728442240926228`*^9, 3.8728443414287043`*^9}, {3.8728443855675373`*^9, 
   3.872844446715354*^9}, {3.8728444837849913`*^9, 3.872844516930936*^9}, {
   3.8728445698996677`*^9, 3.872844576105318*^9}, {3.872844704874819*^9, 
   3.872844710494471*^9}, {3.872844760437141*^9, 3.872844842687961*^9}, {
   3.872845414669299*^9, 3.872845453560335*^9}, {3.872845684022779*^9, 
   3.872845684170787*^9}, {3.872845809562683*^9, 3.8728458139930964`*^9}, {
   3.8728458498635197`*^9, 3.872845867401936*^9}, {3.872845916883953*^9, 
   3.8728459178661757`*^9}, {3.872845951400909*^9, 3.872846012839258*^9}, {
   3.872846094734322*^9, 3.872846096558745*^9}, {3.8728461322756233`*^9, 
   3.8728462411865187`*^9}, 3.872846539812138*^9, {3.872846626559691*^9, 
   3.872846629047997*^9}, {3.872846923916967*^9, 3.8728469243123703`*^9}, {
   3.872846988503901*^9, 3.872846988641983*^9}, 3.872847039330594*^9, {
   3.872908376348083*^9, 3.872908377815778*^9}, {3.8735199206947317`*^9, 
   3.873519961079748*^9}, {3.8735199930332527`*^9, 3.8735202147493057`*^9}, {
   3.8735202470979958`*^9, 3.873520258247385*^9}, {3.8735203168293037`*^9, 
   3.8735203601875467`*^9}, {3.8735206598769608`*^9, 3.873520788453281*^9}, {
   3.87352084268828*^9, 3.873520877096634*^9}, {3.873520909654594*^9, 
   3.873521010243105*^9}, {3.873537699428405*^9, 3.873537712206647*^9}, 
   3.873537849501217*^9, {3.8735379063461027`*^9, 3.873538003131442*^9}, {
   3.873538067593025*^9, 3.8735381834890013`*^9}, {3.873538299005363*^9, 
   3.87353832771821*^9}, {3.876386099139866*^9, 3.8763861713297863`*^9}, {
   3.876386203644589*^9, 3.876386322224472*^9}, {3.876386493610466*^9, 
   3.876386497192384*^9}, {3.876389296933138*^9, 3.876389466904985*^9}, {
   3.876389505799872*^9, 3.876389514777108*^9}, {3.8763904509398527`*^9, 
   3.8763906180779533`*^9}, {3.876390669293137*^9, 3.876390703312484*^9}, {
   3.8763911788337927`*^9, 3.876391202819601*^9}, {3.876391316203471*^9, 
   3.876391328413418*^9}, {3.876391375817774*^9, 3.876391384414813*^9}, {
   3.876391475160351*^9, 3.876391538839696*^9}, 3.876906529455852*^9, {
   3.8769065880263987`*^9, 3.876906589329658*^9}, {3.877075938395946*^9, 
   3.8770759445204897`*^9}, {3.8770762670964947`*^9, 3.877076351523572*^9}, {
   3.877688265712512*^9, 3.877688352762135*^9}, {3.877688521072369*^9, 
   3.877688521958202*^9}, {3.877688643875822*^9, 3.877688667220685*^9}, {
   3.87768898382051*^9, 3.877689041434021*^9}, {3.877689091267583*^9, 
   3.877689113249461*^9}, 3.877689146021433*^9, {3.877689230014827*^9, 
   3.8776892867130823`*^9}, {3.8776894143639803`*^9, 3.877689528697596*^9}, 
   3.877689589436741*^9, {3.87768963797936*^9, 3.877689644533412*^9}, 
   3.877689676605206*^9, {3.878008284848724*^9, 3.878008287215217*^9}, {
   3.8780089614602613`*^9, 3.8780090320647917`*^9}, {3.898072088360487*^9, 
   3.8980721207013083`*^9}, {3.898072219603279*^9, 3.898072249028965*^9}, {
   3.898137510574627*^9, 3.89813764988491*^9}, {3.898137718195228*^9, 
   3.898137725054879*^9}, 3.898138024873172*^9, 3.898138763236762*^9, {
   3.898138863057393*^9, 3.898139121778823*^9}, {3.89813922958499*^9, 
   3.898139231162723*^9}, {3.8981396899836607`*^9, 3.898139712126795*^9}, {
   3.898139756319043*^9, 3.898139759897064*^9}, {3.8981398035683947`*^9, 
   3.898139808833729*^9}, {3.8981400551052217`*^9, 3.898140056950885*^9}, 
   3.8981401018287573`*^9},
 CellLabel->"In[2]:=",ExpressionUUID->"6def1ead-9d11-4736-a756-0c94ad97d530"]
}, Closed]],

Cell[CellGroupData[{

Cell["Spatial orbitals", "Title",
 CellChangeTimes->{{3.8780069122740307`*^9, 
  3.8780069148011*^9}},ExpressionUUID->"07f71bfa-ca04-40d7-9caf-583f479af977"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"spatialorbG0F2", "[", 
    RowBox[{
    "nBas_", ",", "nO_", ",", "nV_", ",", "\[Epsilon]_", ",", "ERI_", ",", 
     "ENuc_", ",", "ERHF_", ",", "options_", ",", "verbose_", ",", 
     "regularizerorbital_", ",", "regularizerselfenergy_"}], "]"}], ":=", 
   "\n", "       ", "\n", "  ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Eta]", ",", "lin", ",", "\[CapitalSigma]x", ",", "\[CapitalSigma]c", 
       ",", "Z", ",", "d\[CapitalSigma]cd\[Omega]", ",", "eG0F2", ",", 
       "EcG0F2", ",", "outputs", ",", "SelfEnergy", ",", 
       "Im\[CapitalSigma]c\[Omega]", ",", "\[CapitalSigma]c\[Omega]", ",", 
       "Im\[CapitalSigma]c", ",", "\n", "          ", ",", "eG0F2lin", ",", 
       "IP", ",", "eRenorm", ",", "TabG0F2", ",", "BSE", ",", "TDA", ",", 
       "dBSE", ",", "dTDA", ",", "singlet", ",", "triplet", ",", "EcBSE"}], 
      "}"}], ",", "\n", "          ", "\n", "    ", 
     RowBox[{"(*", " ", "options", " ", "*)"}], "\n", "    ", 
     RowBox[{
      RowBox[{"\[Eta]", "=", 
       RowBox[{"options", "[", "\"\<\[Eta]\>\"", "]"}]}], ";", "\n", "    ", 
      RowBox[{"lin", "=", 
       RowBox[{"options", "[", "\"\<linearized\>\"", "]"}]}], ";", "\n", 
      "    ", 
      RowBox[{"BSE", " ", "=", " ", 
       RowBox[{
       "options", "\[LeftDoubleBracket]", "\"\<BSE\>\"", 
        "\[RightDoubleBracket]"}]}], ";", "\n", "    ", 
      RowBox[{"TDA", " ", "=", " ", 
       RowBox[{
       "options", "\[LeftDoubleBracket]", "\"\<TDA\>\"", 
        "\[RightDoubleBracket]"}]}], ";", "\n", "    ", 
      RowBox[{"dBSE", " ", "=", " ", 
       RowBox[{
       "options", "\[LeftDoubleBracket]", "\"\<dBSE\>\"", 
        "\[RightDoubleBracket]"}]}], ";", "\n", "    ", 
      RowBox[{"dTDA", " ", "=", " ", 
       RowBox[{
       "options", "\[LeftDoubleBracket]", "\"\<dTDA\>\"", 
        "\[RightDoubleBracket]"}]}], ";", "\n", "    ", 
      RowBox[{"singlet", " ", "=", " ", 
       RowBox[{
       "options", "\[LeftDoubleBracket]", "\"\<singlet\>\"", 
        "\[RightDoubleBracket]"}]}], ";", "\n", "    ", 
      RowBox[{"triplet", " ", "=", " ", 
       RowBox[{
       "options", "\[LeftDoubleBracket]", "\"\<triplet\>\"", 
        "\[RightDoubleBracket]"}]}], ";", "\n", "    ", "\n", "    ", 
      RowBox[{"(*", " ", 
       RowBox[{"Renormalized", " ", "orbital", " ", "energies"}], " ", "*)"}],
       "\n", "    ", 
      RowBox[{"eRenorm", "=", 
       RowBox[{"\[Epsilon]", "+", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           UnderoverscriptBox["\[Sum]", 
            RowBox[{"i", "=", "1"}], "nO"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"j", "=", "1"}], "nO"], 
            RowBox[{
             UnderoverscriptBox["\[Sum]", 
              RowBox[{"a", "=", 
               RowBox[{"nO", "+", "1"}]}], "nBas"], 
             RowBox[{
              FractionBox[
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"2", 
                   RowBox[{"ERI", "\[LeftDoubleBracket]", 
                    RowBox[{"p", ",", "a", ",", "i", ",", "j"}], 
                    "\[RightDoubleBracket]"}]}], "-", 
                  RowBox[{"ERI", "\[LeftDoubleBracket]", 
                   RowBox[{"p", ",", "a", ",", "j", ",", "i"}], 
                   "\[RightDoubleBracket]"}]}], ")"}], 
                RowBox[{"ERI", "\[LeftDoubleBracket]", 
                 RowBox[{"p", ",", "a", ",", "i", ",", "j"}], 
                 "\[RightDoubleBracket]"}]}], 
               RowBox[{
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                 "\[RightDoubleBracket]"}], "-", 
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "-", 
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                 "\[RightDoubleBracket]"}], "-", 
                RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}]], 
              RowBox[{"regularizerorbital", "[", 
               RowBox[{
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                   "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}]}], ";", "\n", "    ", 
      
      RowBox[{"eRenorm", "=", 
       RowBox[{"eRenorm", "+", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           UnderoverscriptBox["\[Sum]", 
            RowBox[{"i", "=", "1"}], "nO"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"a", "=", 
              RowBox[{"nO", "+", "1"}]}], "nBas"], 
            RowBox[{
             UnderoverscriptBox["\[Sum]", 
              RowBox[{"b", "=", 
               RowBox[{"nO", "+", "1"}]}], "nBas"], 
             RowBox[{
              FractionBox[
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"2", 
                   RowBox[{"ERI", "\[LeftDoubleBracket]", 
                    RowBox[{"p", ",", "i", ",", "a", ",", "b"}], 
                    "\[RightDoubleBracket]"}]}], "-", 
                  RowBox[{"ERI", "\[LeftDoubleBracket]", 
                   RowBox[{"p", ",", "i", ",", "b", ",", "a"}], 
                   "\[RightDoubleBracket]"}]}], ")"}], 
                RowBox[{"ERI", "\[LeftDoubleBracket]", 
                 RowBox[{"p", ",", "i", ",", "a", ",", "b"}], 
                 "\[RightDoubleBracket]"}]}], 
               RowBox[{
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "-", 
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                 "\[RightDoubleBracket]"}], "-", 
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}]], 
              RowBox[{"regularizerorbital", "[", 
               RowBox[{
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                   "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}]}], ";", "\n", "\t", 
      RowBox[{"eRenorm", "=", 
       RowBox[{"Re", "[", "eRenorm", "]"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{"Self", " ", "energy"}], " ", "*)"}], "\n", "\t", 
      RowBox[{"\[CapitalSigma]c\[Omega]", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          UnderoverscriptBox["\[Sum]", 
           RowBox[{"i", "=", "1"}], "nO"], 
          RowBox[{
           UnderoverscriptBox["\[Sum]", 
            RowBox[{"j", "=", "1"}], "nO"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"a", "=", 
              RowBox[{"nO", "+", "1"}]}], "nBas"], 
            RowBox[{
             FractionBox[
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"2", 
                  RowBox[{"ERI", "\[LeftDoubleBracket]", 
                   RowBox[{"p", ",", "a", ",", "i", ",", "j"}], 
                   "\[RightDoubleBracket]"}]}], "-", 
                 RowBox[{"ERI", "\[LeftDoubleBracket]", 
                  RowBox[{"p", ",", "a", ",", "j", ",", "i"}], 
                  "\[RightDoubleBracket]"}]}], ")"}], 
               RowBox[{"ERI", "\[LeftDoubleBracket]", 
                RowBox[{"p", ",", "a", ",", "i", ",", "j"}], 
                "\[RightDoubleBracket]"}]}], 
              RowBox[{"\[Omega]", "+", 
               RowBox[{
               "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                "\[RightDoubleBracket]"}], "-", 
               RowBox[{
               "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}], "-", 
               RowBox[{
               "\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                "\[RightDoubleBracket]"}], "-", 
               RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}]], 
             RowBox[{"regularizerselfenergy", "[", 
              RowBox[{
               RowBox[{
               "\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                "\[RightDoubleBracket]"}], "+", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                 "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                  "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"\[CapitalSigma]c\[Omega]", "=", 
       RowBox[{"\[CapitalSigma]c\[Omega]", "+", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           UnderoverscriptBox["\[Sum]", 
            RowBox[{"i", "=", "1"}], "nO"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"a", "=", 
              RowBox[{"nO", "+", "1"}]}], "nBas"], 
            RowBox[{
             UnderoverscriptBox["\[Sum]", 
              RowBox[{"b", "=", 
               RowBox[{"nO", "+", "1"}]}], "nBas"], 
             RowBox[{
              FractionBox[
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"2", 
                   RowBox[{"ERI", "\[LeftDoubleBracket]", 
                    RowBox[{"p", ",", "i", ",", "a", ",", "b"}], 
                    "\[RightDoubleBracket]"}]}], "-", 
                  RowBox[{"ERI", "\[LeftDoubleBracket]", 
                   RowBox[{"p", ",", "i", ",", "b", ",", "a"}], 
                   "\[RightDoubleBracket]"}]}], ")"}], 
                RowBox[{"ERI", "\[LeftDoubleBracket]", 
                 RowBox[{"p", ",", "i", ",", "a", ",", "b"}], 
                 "\[RightDoubleBracket]"}]}], 
               RowBox[{"\[Omega]", "+", 
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "-", 
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                 "\[RightDoubleBracket]"}], "-", 
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}]], 
              RowBox[{"regularizerselfenergy", "[", 
               RowBox[{
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                   "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}]}], ";", "\n", "\t", 
      "\n", "\t", 
      RowBox[{"\[CapitalSigma]c\[Omega]", "=", 
       RowBox[{"Re", "[", "\[CapitalSigma]c\[Omega]", "]"}]}], ";", "\n", 
      "\t", 
      RowBox[{"\[CapitalSigma]c", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "\[CapitalSigma]c\[Omega]", "\[LeftDoubleBracket]", "p", 
           "\[RightDoubleBracket]"}], "/.", 
          RowBox[{"\[Omega]", "\[Rule]", 
           RowBox[{
           "eRenorm", "\[LeftDoubleBracket]", "p", 
            "\[RightDoubleBracket]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}], ";", "\n", "\t", "\n",
       "\t", "\n", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{"Renormalization", " ", "factor"}], " ", "*)"}], "\n", "\t", 
      RowBox[{"d\[CapitalSigma]cd\[Omega]", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          UnderoverscriptBox["\[Sum]", 
           RowBox[{"i", "=", "1"}], "nO"], 
          RowBox[{
           UnderoverscriptBox["\[Sum]", 
            RowBox[{"j", "=", "1"}], "nO"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"a", "=", 
              RowBox[{"nO", "+", "1"}]}], "nBas"], 
            RowBox[{
             FractionBox[
              RowBox[{
               RowBox[{"-", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"2", 
                   RowBox[{"ERI", "\[LeftDoubleBracket]", 
                    RowBox[{"p", ",", "a", ",", "i", ",", "j"}], 
                    "\[RightDoubleBracket]"}]}], "-", 
                  RowBox[{"ERI", "\[LeftDoubleBracket]", 
                   RowBox[{"p", ",", "a", ",", "j", ",", "i"}], 
                   "\[RightDoubleBracket]"}]}], ")"}]}], 
               RowBox[{"ERI", "\[LeftDoubleBracket]", 
                RowBox[{"p", ",", "a", ",", "i", ",", "j"}], 
                "\[RightDoubleBracket]"}]}], 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"\[Omega]", "+", 
                 RowBox[{
                 "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}], ")"}], "2"]], 
             RowBox[{"regularizerselfenergy", "[", 
              RowBox[{
               RowBox[{
               "\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                "\[RightDoubleBracket]"}], "+", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                 "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "\[Epsilon]", "\[LeftDoubleBracket]", "j", 
                  "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"d\[CapitalSigma]cd\[Omega]", "=", 
       RowBox[{"d\[CapitalSigma]cd\[Omega]", "+", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           UnderoverscriptBox["\[Sum]", 
            RowBox[{"i", "=", "1"}], "nO"], 
           RowBox[{
            UnderoverscriptBox["\[Sum]", 
             RowBox[{"a", "=", 
              RowBox[{"nO", "+", "1"}]}], "nBas"], 
            RowBox[{
             UnderoverscriptBox["\[Sum]", 
              RowBox[{"b", "=", 
               RowBox[{"nO", "+", "1"}]}], "nBas"], 
             RowBox[{
              FractionBox[
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"2", 
                    RowBox[{"ERI", "\[LeftDoubleBracket]", 
                    RowBox[{"p", ",", "i", ",", "a", ",", "b"}], 
                    "\[RightDoubleBracket]"}]}], "-", 
                   RowBox[{"ERI", "\[LeftDoubleBracket]", 
                    RowBox[{"p", ",", "i", ",", "b", ",", "a"}], 
                    "\[RightDoubleBracket]"}]}], ")"}]}], 
                RowBox[{"ERI", "\[LeftDoubleBracket]", 
                 RowBox[{"p", ",", "i", ",", "a", ",", "b"}], 
                 "\[RightDoubleBracket]"}]}], 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"\[Omega]", "+", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{"\[ImaginaryI]", "*", "\[Eta]"}]}], ")"}], "2"]], 
              RowBox[{"regularizerselfenergy", "[", 
               RowBox[{
                RowBox[{
                "\[Epsilon]", "\[LeftDoubleBracket]", "p", 
                 "\[RightDoubleBracket]"}], "+", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "a", 
                   "\[RightDoubleBracket]"}], "-", 
                  RowBox[{
                  "\[Epsilon]", "\[LeftDoubleBracket]", "b", 
                   "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}]}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}]}], ";", "\n", "\t", 
      "\n", "\t", "\n", "\t", 
      RowBox[{"d\[CapitalSigma]cd\[Omega]", "=", 
       RowBox[{"Re", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "d\[CapitalSigma]cd\[Omega]", "\[LeftDoubleBracket]", "p", 
            "\[RightDoubleBracket]"}], "/.", 
           RowBox[{"\[Omega]", "\[Rule]", 
            RowBox[{
            "eRenorm", "\[LeftDoubleBracket]", "p", 
             "\[RightDoubleBracket]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}], "]"}]}], ";", "\n", 
      "\n", "\t", 
      RowBox[{"Z", "=", 
       FractionBox["1", 
        RowBox[{"1", "-", "d\[CapitalSigma]cd\[Omega]"}]]}], ";", "\n", "\n", 
      "\n", "    ", 
      RowBox[{"(*", " ", 
       RowBox[{"Linearized", " ", "Quasiparticle", " ", "equation"}], " ", 
       "*)"}], "\n", "    ", 
      RowBox[{"eG0F2lin", "=", 
       RowBox[{"eRenorm", "+", 
        RowBox[{"Z", "*", "\[CapitalSigma]c"}]}]}], ";", "\n", "\n", "    ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"lin", "\[Equal]", "True"}], ",", "\n", "    ", "\n", 
        "      ", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"verbose", "\[Equal]", "True"}], ",", " ", "\n", 
           "        ", 
           RowBox[{
            RowBox[{
            "Print", "[", "\"\<QP energies obtained by linearization !\>\"", 
             "]"}], ";"}], "\n", "        ", ",", 
           RowBox[{"(*", "else", "*)"}], "\n", "        ", 
           RowBox[{
            RowBox[{
            "PrintTemporary", "[", 
             "\"\<QP energies obtained by linearization !\>\"", "]"}], 
            ";"}]}], "\n", "      ", "]"}], ";", "\n", "      ", "\n", 
         "      ", 
         RowBox[{"eG0F2", " ", "=", " ", "eG0F2lin"}], ";"}], "\n", " ", "\n",
         "      ", ",", 
        RowBox[{"(*", "else", "*)"}], "\n", "      ", "\n", "      ", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"verbose", "\[Equal]", "True"}], ",", " ", "\n", 
           "        ", 
           RowBox[{
            RowBox[{
            "Print", "[", "\"\<QP energies obtained by root search !\>\"", 
             "]"}], ";"}], "\n", "        ", ",", 
           RowBox[{"(*", "else", "*)"}], "\n", "        ", 
           RowBox[{
            RowBox[{
            "PrintTemporary", "[", 
             "\"\<QP energies obtained by root search !\>\"", "]"}], ";"}]}], 
          "\n", "      ", "]"}], ";", "\n", "        ", "\n", "      ", 
         RowBox[{"eG0F2", " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"\[Omega]", "/.", 
             RowBox[{"FindRoot", "[", 
              RowBox[{
               RowBox[{"\[Omega]", "\[Equal]", 
                RowBox[{
                 RowBox[{
                 "eRenorm", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}], "+", 
                 RowBox[{
                 "\[CapitalSigma]c\[Omega]", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Omega]", ",", 
                 RowBox[{
                 "eG0F2lin", "\[LeftDoubleBracket]", "p", 
                  "\[RightDoubleBracket]"}]}], "}"}]}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"p", ",", "nBas"}], "}"}]}], "]"}]}], ";"}]}], "\n", " ",
        "\n", "    ", "]"}], ";", "\n", "    ", "\n", "    ", 
      RowBox[{"(*", " ", 
       RowBox[{"Choose", " ", "the", " ", "first", " ", "IP"}], " ", "*)"}], 
      "\n", "    ", 
      RowBox[{"IP", "=", 
       RowBox[{
        RowBox[{
        "eG0F2", "\[LeftDoubleBracket]", "nO", "\[RightDoubleBracket]"}], "*",
         "HaToeV"}]}], ";", "\n", "    ", "\n", "    ", 
      RowBox[{"(*", " ", 
       RowBox[{"MP2", " ", "correlation", " ", "energy"}], " ", "*)"}], "\n", 
      "    ", 
      RowBox[{"NotebookEvaluate", "[", 
       RowBox[{"path", "<>", "\"\</src/MP/MP2.nb\>\""}], "]"}], ";", "\n", 
      "    ", 
      RowBox[{"EcG0F2", " ", "=", " ", 
       RowBox[{"MP2", "[", 
        RowBox[{"nBas", ",", "nO", ",", "ERI", ",", "eG0F2", ",", "options"}],
         "]"}]}], ";", "\n", "    ", "\n", "    ", 
      RowBox[{"(*", " ", 
       RowBox[{"Print", " ", "outputs"}], " ", "*)"}], "\n", "    ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"verbose", "\[Equal]", "True"}], ",", "\n", "      ", 
        RowBox[{
         RowBox[{"NotebookEvaluate", "[", 
          RowBox[{"path", "<>", "\"\</src/GF/print_G0F2.nb\>\""}], "]"}], ";",
          "\n", "      ", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<G0F2 outputs:\>\"", ",", "Bold", ",", "Red"}], "]"}], 
          "]"}], ";", "\n", "      ", 
         RowBox[{"TabG0F2", " ", "=", " ", 
          RowBox[{"PrintG0F2", "[", 
           RowBox[{
           "nO", ",", "\[Epsilon]", ",", "\[CapitalSigma]c", ",", "Z", ",", 
            "eG0F2", ",", "ENuc", ",", "ERHF", ",", "EcG0F2"}], "]"}]}], ";", 
         "\n", "      ", 
         RowBox[{"Print", "[", "TabG0F2", "]"}], ";"}]}], "\n", "    ", "]"}],
       ";", "\n", "    ", "\n", "    ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"BSE", "\[Equal]", "True"}], ",", "\n", "      ", 
        RowBox[{
         RowBox[{"PrintTemporary", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<BSE calculation...\>\"", ",", "Bold", ",", "Orange"}],
            "]"}], "]"}], ";", "\n", "      ", 
         RowBox[{"NotebookEvaluate", "[", 
          RowBox[{"path", "<>", "\"\</src/GF/BSE2.nb\>\""}], "]"}], ";", "\n",
          "      ", "\n", "      ", 
         RowBox[{"EcBSE", " ", "=", " ", 
          RowBox[{"BSE2", "[", 
           RowBox[{
           "nBas", ",", "nO", ",", "nV", ",", "\[Epsilon]", ",", "eG0F2", ",",
             "ERI", ",", "TDA", ",", "dBSE", ",", "dTDA", ",", "singlet", ",",
             "triplet", ",", "\[Eta]", ",", "verbose"}], "]"}]}], ";"}]}], 
       "\n", "    ", "]"}], ";", "\n", "\n", "    ", 
      RowBox[{"outputs", " ", "=", " ", 
       RowBox[{"Association", "[", 
        RowBox[{
         RowBox[{"\"\<EcMP2\>\"", "\[Rule]", "EcG0F2"}], ",", 
         RowBox[{"\"\<eG0F2\>\"", "\[Rule]", "eG0F2"}], ",", 
         RowBox[{"\"\<IP\>\"", "\[Rule]", "IP"}]}], "]"}]}], ";", "\n", "\n", 
      "    ", 
      RowBox[{"Return", "[", "outputs", "]"}]}]}], "\n", "  ", "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.872844083344153*^9, 3.8728441243136063`*^9}, {
   3.8728442240926228`*^9, 3.8728443414287043`*^9}, {3.8728443855675373`*^9, 
   3.872844446715354*^9}, {3.8728444837849913`*^9, 3.872844516930936*^9}, {
   3.8728445698996677`*^9, 3.872844576105318*^9}, {3.872844704874819*^9, 
   3.872844710494471*^9}, {3.872844760437141*^9, 3.872844842687961*^9}, {
   3.872845414669299*^9, 3.872845453560335*^9}, {3.872845684022779*^9, 
   3.872845684170787*^9}, {3.872845809562683*^9, 3.8728458139930964`*^9}, {
   3.8728458498635197`*^9, 3.872845867401936*^9}, {3.872845916883953*^9, 
   3.8728459178661757`*^9}, {3.872845951400909*^9, 3.872846012839258*^9}, {
   3.872846094734322*^9, 3.872846096558745*^9}, {3.8728461322756233`*^9, 
   3.8728462411865187`*^9}, 3.872846539812138*^9, {3.872846626559691*^9, 
   3.872846629047997*^9}, {3.872846923916967*^9, 3.8728469243123703`*^9}, {
   3.872846988503901*^9, 3.872846988641983*^9}, 3.872847039330594*^9, {
   3.872908376348083*^9, 3.872908377815778*^9}, {3.8735199206947317`*^9, 
   3.873519961079748*^9}, {3.8735199930332527`*^9, 3.8735202147493057`*^9}, {
   3.8735202470979958`*^9, 3.873520258247385*^9}, {3.8735203168293037`*^9, 
   3.8735203601875467`*^9}, {3.8735206598769608`*^9, 3.873520788453281*^9}, {
   3.87352084268828*^9, 3.873520877096634*^9}, {3.873520909654594*^9, 
   3.873521010243105*^9}, {3.873537699428405*^9, 3.873537712206647*^9}, 
   3.873537849501217*^9, {3.8735379063461027`*^9, 3.873538003131442*^9}, {
   3.873538067593025*^9, 3.8735381834890013`*^9}, {3.873538299005363*^9, 
   3.87353832771821*^9}, {3.876386099139866*^9, 3.8763861713297863`*^9}, {
   3.876386203644589*^9, 3.876386322224472*^9}, {3.876386493610466*^9, 
   3.876386497192384*^9}, {3.876389296933138*^9, 3.876389466904985*^9}, {
   3.876389505799872*^9, 3.876389514777108*^9}, {3.8763904509398527`*^9, 
   3.8763906180779533`*^9}, {3.876390669293137*^9, 3.876390703312484*^9}, {
   3.8763911788337927`*^9, 3.876391202819601*^9}, {3.876391316203471*^9, 
   3.876391328413418*^9}, {3.876391375817774*^9, 3.876391384414813*^9}, {
   3.876391475160351*^9, 3.876391538839696*^9}, 3.876906529455852*^9, {
   3.8769065880263987`*^9, 3.876906589329658*^9}, {3.877075938395946*^9, 
   3.8770759445204897`*^9}, {3.8770762670964947`*^9, 3.877076351523572*^9}, {
   3.877688265712512*^9, 3.877688352762135*^9}, {3.877688521072369*^9, 
   3.877688521958202*^9}, {3.877688643875822*^9, 3.877688667220685*^9}, {
   3.87768898382051*^9, 3.877689041434021*^9}, {3.877689091267583*^9, 
   3.877689113249461*^9}, 3.877689146021433*^9, {3.877689230014827*^9, 
   3.8776892867130823`*^9}, {3.8776894143639803`*^9, 3.877689528697596*^9}, 
   3.877689589436741*^9, {3.87768963797936*^9, 3.877689644533412*^9}, 
   3.877689676605206*^9, {3.878008284848724*^9, 3.878008287215217*^9}, {
   3.8780089614602613`*^9, 3.8780090320647917`*^9}, {3.878617871569333*^9, 
   3.878617896817059*^9}, {3.878617937197772*^9, 3.878617964235778*^9}, {
   3.878617998848976*^9, 3.8786180585779057`*^9}, {3.878618097758273*^9, 
   3.878618129160164*^9}, {3.8786181811078243`*^9, 3.878618192307068*^9}, {
   3.8786182360322447`*^9, 3.878618349949708*^9}, {3.878618392398732*^9, 
   3.8786184998865423`*^9}, {3.878618648900527*^9, 3.878618932321705*^9}, {
   3.8786189933277187`*^9, 3.8786190860942593`*^9}, {3.8786195876685457`*^9, 
   3.878619689531197*^9}, 3.8786197226361933`*^9, {3.878619779586042*^9, 
   3.878619805037896*^9}, {3.8817318472022*^9, 3.8817318644815598`*^9}, 
   3.881732299232876*^9, 3.881738050113604*^9, {3.881898559980736*^9, 
   3.881898573243659*^9}, {3.8818987030802717`*^9, 3.8818987553628187`*^9}, {
   3.8819009935051126`*^9, 3.88190100785928*^9}, {3.8819010420340223`*^9, 
   3.881901197685581*^9}, {3.898072565099317*^9, 3.89807258930751*^9}, {
   3.898072833825377*^9, 3.898072856483573*^9}, {3.8980730563078613`*^9, 
   3.898073058645494*^9}, {3.898073091279055*^9, 3.8980730976153717`*^9}, {
   3.898073237540019*^9, 3.8980732470762157`*^9}, {3.898073340522489*^9, 
   3.898073353873662*^9}, {3.8980734501426277`*^9, 3.898073450845419*^9}, {
   3.898074316364306*^9, 3.898074325908618*^9}, {3.898074376639423*^9, 
   3.8980744121661577`*^9}, {3.8980746512935743`*^9, 3.898074659249559*^9}, {
   3.898074982798785*^9, 3.8980750250464077`*^9}, {3.898075291164877*^9, 
   3.898075294799617*^9}, {3.898075547345052*^9, 3.898075554722439*^9}, {
   3.8980755941130133`*^9, 3.898075620109276*^9}, {3.898132708158329*^9, 
   3.898132711679379*^9}, {3.898133047414893*^9, 3.8981330539328527`*^9}, {
   3.8981331362658367`*^9, 3.898133358009308*^9}, {3.8981334663602543`*^9, 
   3.898133495051282*^9}, {3.898134006955592*^9, 3.898134040518097*^9}, {
   3.8981340954010973`*^9, 3.898134145929521*^9}, {3.8981342719751873`*^9, 
   3.8981342893484983`*^9}, {3.898134371246004*^9, 3.898134560552314*^9}, {
   3.898134905940124*^9, 3.898134908835292*^9}, {3.89813508025422*^9, 
   3.898135104265047*^9}, 3.898136207439831*^9, 3.898136638374323*^9, {
   3.898136679863242*^9, 3.898136681601509*^9}, {3.898137095300002*^9, 
   3.898137104330703*^9}, {3.8981373897374983`*^9, 3.8981374024468946`*^9}, {
   3.898137442859428*^9, 3.898137466541185*^9}, {3.8981375819665747`*^9, 
   3.898137583012165*^9}, {3.898142734007916*^9, 3.8981427341236877`*^9}, {
   3.898148099917398*^9, 3.898148196576622*^9}, {3.8981482360364237`*^9, 
   3.8981482392823677`*^9}, 3.8981483352728767`*^9, 3.89814837240207*^9, {
   3.898148475218967*^9, 3.898148487374807*^9}, {3.898148832773754*^9, 
   3.898148879343399*^9}, 3.898148913616184*^9, 3.898149229147964*^9, {
   3.898149399847836*^9, 3.898149427172038*^9}, 3.89814945902882*^9, {
   3.898149799340145*^9, 3.898149812179481*^9}, {3.898149863613284*^9, 
   3.8981498655642843`*^9}},ExpressionUUID->"bc98b4a6-fb0c-416c-b7f9-\
47ff5a6a8bc8"]
}, Open  ]]
},
WindowSize->{1313, 786},
WindowMargins->{{Automatic, 45}, {1, Automatic}},
Magnification:>1.25 Inherited,
FrontEndVersion->"12.1 for Mac OS X x86 (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"e257cd5e-b224-4d74-b90f-4ad9455cfc4a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 147, 3, 123, "Title",ExpressionUUID->"e87254f3-ed3e-4a9e-8fd0-285578ce8bdf"],
Cell[730, 27, 6289, 138, 930, "Code",ExpressionUUID->"be91d493-19ce-4a16-83f6-affcdb4c3468"]
}, Open  ]],
Cell[CellGroupData[{
Cell[7056, 170, 160, 3, 123, "Title",ExpressionUUID->"ab838407-d2cf-4002-b195-ee7d9e90a2db"],
Cell[7219, 175, 27471, 609, 2462, "Code",ExpressionUUID->"6def1ead-9d11-4736-a756-0c94ad97d530"]
}, Closed]],
Cell[CellGroupData[{
Cell[34727, 789, 157, 2, 89, "Title",ExpressionUUID->"07f71bfa-ca04-40d7-9caf-583f479af977"],
Cell[34887, 793, 31235, 671, 2462, "Code",ExpressionUUID->"bc98b4a6-fb0c-416c-b7f9-47ff5a6a8bc8"]
}, Open  ]]
}
]
*)

